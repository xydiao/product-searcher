<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœç´¢ç»“æœ - {{ detail.keyword }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“‹ æœç´¢ç»“æœ</h1>
            <p class="subtitle">
                å…³é”®è¯ï¼š<strong>{{ detail.keyword }}</strong> | 
                å¹³å°ï¼š<strong>{{ detail.platform }}</strong> | 
                æ•°é‡ï¼š<strong>{{ detail.top_n }}</strong>
            </p>
        </header>

        <main>
            <div class="result-header">
                <a href="/" class="btn-back">â† è¿”å›æœç´¢</a>
                <a href="/history" class="btn-secondary">ğŸ“š å†å²è®°å½•</a>
            </div>

            <div class="stats-bar">
                <div class="stat-item">
                    <span class="stat-value">{{ detail.top_n }}</span>
                    <span class="stat-label">æœç´¢æ•°é‡</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">{{ detail.created_at[:10] }}</span>
                    <span class="stat-label">æœç´¢æ—¶é—´</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">{{ detail.status }}</span>
                    <span class="stat-label">çŠ¶æ€</span>
                </div>
            </div>

            <div class="results-table-container">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>æ’å</th>
                            <th>äº§å“åç§°</th>
                            <th>ä»·æ ¼</th>
                            <th>è¯„åˆ†</th>
                            <th>è¯„è®ºæ•°</th>
                            <th>æ¥æº</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in detail.details %}
                        <tr>
                            <td class="rank">{{ item.rank }}</td>
                            <td class="title">
                                <a href="{{ item.url }}" target="_blank" rel="noopener">
                                    {{ item.title }}
                                </a>
                                <p class="description">{{ item.description[:100] }}...</p>
                            </td>
                            <td class="price">{{ item.price or '-' }}</td>
                            <td class="rating">{{ item.rating or '-' }}</td>
                            <td class="reviews">{{ item.reviews or '-' }}</td>
                            <td class="source">{{ item.source or '-' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="actions-bar">
                <button onclick="exportCSV()" class="btn-export">ğŸ“¥ å¯¼å‡ºCSV</button>
                <a href="/" class="btn-primary">ğŸ” æ–°æœç´¢</a>
            </div>
        </main>

        <footer>
            <p>Powered by Brave Search API | æ•°æ®ä»…ä¾›å‚è€ƒ</p>
        </footer>
    </div>

    <script>
        function exportCSV() {
            // ç®€å•çš„CSVå¯¼å‡º
            let csv = 'æ’å,äº§å“åç§°,ä»·æ ¼,è¯„åˆ†,è¯„è®ºæ•°,æ¥æº,é“¾æ¥\n';
            
            {% for item in detail.details %}
            csv += '{{ item.rank }},"{{ item.title.replace('"', '""') }}","{{ item.price or '' }}","{{ item.rating or '' }}","{{ item.reviews or '' }}","{{ item.source or '' }}","{{ item.url }}"';
            csv += '\n';
            {% endfor %}
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'search_results_{{ detail.keyword }}_{{ detail.created_at[:10] }}.csv';
            link.click();
        }
    </script>
</body>
</html>
